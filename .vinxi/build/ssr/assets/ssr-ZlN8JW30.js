import{H3Event as R,getRequestURL as W,getResponseHeaders as U,getRequestWebStream as z,eventHandler as Z}from"h3";import{getContext as G}from"unctx";import{AsyncLocalStorage as J}from"node:async_hooks";import{isPlainArray as V,isPlainObject as P,defer as Q,useRouter as f,ScriptOnce as S,pick as X,createControlledPromise as Y,RouterProvider as K,createMemoryHistory as ee,useRouterState as x,Link as b,createRootRoute as te,Outlet as re,ScrollRestoration as ne,createFileRoute as oe,lazyRouteComponent as se,useMatch as ae,rootRouteId as ie,ErrorComponent as ce,createRouter as ue}from"@tanstack/react-router";import{jsxs as m,Fragment as y,jsx as i}from"react/jsx-runtime";import*as g from"react";import{createElement as I,createContext as le,useState as de,useEffect as me,useContext as fe}from"react";import _ from"jsesc";import pe from"tiny-invariant";import{Transform as he,PassThrough as ye}from"node:stream";import{isbot as E}from"isbot";import v from"react-dom/server";import{Context as L}from"@tanstack/react-cross-context";import{createPortal as ge}from"react-dom";function xe(e,t,r){if(!r.router.isServer)return t;r.match.extracted=r.match.extracted||[];const n=r.match.extracted;return T(t,(s,a)=>{const c=s instanceof ReadableStream?"stream":s instanceof Promise?"promise":void 0;if(c){const u={dataType:e,type:c,path:a,id:n.length,value:s,matchIndex:r.match.index};if(n.push(u),c==="stream"){const[l,d]=s.tee();return u.streamState=Re({stream:d}),l}else Q(s)}return s})}function Se(e){const t=f(),r=t.state.matches[e.matchIndex];if(!t.isServer)return null;const n=r.extracted,[o,s]=["__beforeLoadContext","loaderData"].map(a=>n?n.reduce((c,u)=>u.dataType!==a?k(c,["temp",...u.path],void 0):c,{temp:r[a]}).temp:r[a]);return m(y,{children:[o!==void 0||s!==void 0||n?.length?i(S,{children:`__TSR__.matches[${e.matchIndex}] = ${_({__beforeLoadContext:t.options.transformer.stringify(o),loaderData:t.options.transformer.stringify(s),extracted:n?Object.fromEntries(n.map(a=>[a.id,X(a,["type","path"])])):{}},{isScriptContext:!0,wrap:!0,json:!0})}; __TSR__.initMatch(${e.matchIndex})`}):null,n?n.map((a,c)=>a.type==="stream"?i(we,{entry:a},a.id):i(_e,{entry:a},a.id)):null]})}function T(e,t,r=[]){if(V(e))return e.map((o,s)=>T(o,t,[...r,`${s}`]));if(P(e)){const o={};for(const s in e)o[s]=T(e[s],t,[...r,s]);return o}const n=t(e,r);return n!==e?n:e}function _e({entry:e}){return i("div",{className:"tsr-once",children:i(g.Suspense,{fallback:null,children:i(ve,{entry:e})})})}function ve({entry:e}){if(e.value.status==="pending")throw e.value;return i(S,{children:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].resolve(${_(e.value.data,{isScriptContext:!0,wrap:!0,json:!0})})`})}function we({entry:e}){return pe(e.streamState,"StreamState should be defined"),i($,{streamState:e.streamState,children:t=>i(S,{children:t?`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.enqueue(new TextEncoder().encode(${_(t.toString(),{isScriptContext:!0,wrap:!0,json:!0})}))`:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.close()`})})}function Re({stream:e}){const t={promises:[]},r=e.getReader(),n=o=>(t.promises[o]=Y(),r.read().then(({done:s,value:a})=>{if(s){t.promises[o].resolve(null),r.releaseLock();return}return t.promises[o].resolve(a),n(o+1)}));return n(0).catch(o=>{console.error("stream read error",o)}),t}function $({streamState:e,children:t,__index:r=0}){const n=e.promises[r];if(!n)return null;if(n.status==="pending")throw n;const o=n.value;return m(y,{children:[t(o),i("div",{className:"tsr-once",children:i(g.Suspense,{fallback:null,children:i($,{streamState:e,__index:r+1,children:t})})})]})}function k(e,t,r){if(t.length===0)return r;const[n,...o]=t;return Array.isArray(e)?e.map((s,a)=>a===Number(n)?k(s,o,r):s):P(e)?{...e,[n]:k(e[n],o,r)}:e}function H(e){e.router.AfterEachMatch=Se,e.router.serializer=n=>_(n,{isScriptContext:!0,wrap:!0,json:!0});const t=L.get("TanStackRouterHydrationContext",{}),r=g.useMemo(()=>{var n,o;return{router:e.router.dehydrate(),payload:(o=(n=e.router.options).dehydrate)==null?void 0:o.call(n)}},[e.router]);return i(t.Provider,{value:r,children:i(K,{router:e.router})})}function be(e){let t;const r=q(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(r,{...n,body:e.node.req.body}):new Request(r,{...n,get body(){return t||(t=He(e),t)}})}function Te(e){return e.web??={request:be(e),url:q(e)},e.web.request}function ke(){return Pe()}const A=Symbol("$HTTPEvent");function Ce(e){return typeof e=="object"&&(e instanceof R||e?.[A]instanceof R||e?.__is_event__===!0)}function C(e){return function(...t){let r=t[0];if(Ce(r))t[0]=r instanceof R||r.__is_event__?r:r[A];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(r=ke(),!r)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(r)}return e(...t)}}const q=C(W),Ee=C(U),He=C(z);function Me(){return G("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:J})}function Pe(){return Me().use().event}function Ie(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function M(...e){return e.reduce((t,r)=>{const n=Ie(r);for(const[o,s]of n.entries())t.set(o,s);return t},new Headers)}const Le="server-fn-return-type",$e="server-fn-payload-type";function Ae({createRouter:e,getRouterManifest:t}){return r=>Z(async n=>{const o=Te(n),s=new URL(o.url),a=s.href.replace(s.origin,""),c=ee({initialEntries:[a]}),u=e();u.serializeLoaderData=xe,t&&(u.manifest=t()),u.update({history:c}),await u.load();const l=qe({event:n,router:u});return await r({request:o,router:u,responseHeaders:l})})}function qe(e){e.event.__tsrHeadersSent=!0;let t=M(Ee(e.event),{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(n=>n.headers));const{redirect:r}=e.router.state;return r&&(t=M(t,r.headers,{Location:r.href})),[Le,$e].forEach(n=>{t.delete(n)}),t}function Ne(e){const t=N(()=>e.injectedHtml.map(r=>r()).join(""));return new he({transform(r,n,o){t.transform(r,this.push.bind(this)).then(()=>o()).catch(s=>o(s))},flush(r){t.flush(this.push.bind(this)).then(()=>r()).catch(n=>r(n))}})}function Be(e){const t=N(()=>e.injectedHtml.map(n=>n()).join("")),r=new TextEncoder;return new TransformStream({transform(n,o){return t.transform(n,s=>(o.enqueue(r.encode(s)),!0))},flush(n){return t.flush(o=>(n.enqueue(o),!0))}})}const De=/(<body)/,je=/(<\/body>)/,Fe=/(<\/html>)/,Oe=/(<\/[a-zA-Z][\w:.-]*?>)/g,We=new TextDecoder;function N(e){let t=!1,r="",n="";return{async transform(o,s){const a=r+We.decode(o),c=a.match(De),u=a.match(je),l=a.match(Fe);try{if(c&&(t=!0),!t){s(a),r="";return}const d=e();if(u&&l&&u.index<l.index){const p=u.index+u[0].length,h=l.index+l[0].length,w=a.slice(0,p)+d+a.slice(p,h)+a.slice(h);s(w),r=""}else{let p,h=0;for(;(p=Oe.exec(a))!==null;)h=p.index+p[0].length;if(h>0){const w=a.slice(0,h)+d+n;s(w),r=a.slice(h)}else r=a,n+=d}}catch(d){throw console.error(d),d}},async flush(o){r&&o(r)}}}const Ue=async({request:e,router:t,responseHeaders:r})=>{if(typeof v.renderToReadableStream=="function"){const n=await v.renderToReadableStream(i(H,{router:t}),{signal:e.signal,onError(a,c){console.error(a,c)}});E(e.headers.get("User-Agent"))&&await n.allReady;const s=[Be(t)].reduce((a,c)=>a.pipeThrough(c),n);return new Response(s,{status:t.state.statusCode,headers:r})}if(typeof v.renderToPipeableStream=="function"){const n=new ye,o=v.renderToPipeableStream(i(H,{router:t}),{...E(e.headers.get("User-Agent"))?{onAllReady(){o.pipe(n)}}:{onShellReady(){o.pipe(n)}},onShellError(c){throw c}}),a=[Ne(t)].reduce((c,u)=>c.pipe(u),n);return new Response(a,{status:t.state.statusCode,headers:r})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")},ze=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/"],preloads:["/_build/assets/client-pZQxO3iq.js","/_build/assets/client-BxjpI9UA.js"]},"/":{filePath:"index.tsx"}}});function Ze(e){return globalThis.MANIFEST[e]}function Ge(){const e=ze(),t=e.routes.__root__=e.routes.__root__||{};t.assets=t.assets||[];const r=Ze("client");return t.assets.push({tag:"script",attrs:{src:r.inputs[r.handler]?.output.path,type:"module",async:!0,suppressHydrationWarning:!0}}),e}function Je(){const e=Ge();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([t,r])=>{const{preloads:n,assets:o}=r;return[t,{preloads:n,assets:o}]}))}}function B({tag:e,attrs:t,children:r}){switch(e){case"title":return i("title",{...t,suppressHydrationWarning:!0,children:r});case"meta":return i("meta",{...t,suppressHydrationWarning:!0});case"link":return i("link",{...t,suppressHydrationWarning:!0});case"style":return i("style",{...t,dangerouslySetInnerHTML:{__html:r}});case"script":return t&&t.src?i("script",{...t,suppressHydrationWarning:!0}):typeof r=="string"?i("script",{...t,dangerouslySetInnerHTML:{__html:r},suppressHydrationWarning:!0}):null;default:return null}}const Ve=()=>{const e=f(),t=x({select:s=>s.matches.map(a=>a.meta).filter(Boolean)}),r=g.useMemo(()=>{const s=[],a={};let c;return[...t].reverse().forEach(u=>{[...u].reverse().forEach(l=>{if(l.title)c||(c={tag:"title",children:l.title});else{if(l.name){if(a[l.name])return;a[l.name]=!0}s.push({tag:"meta",attrs:{...l}})}})}),c&&s.push(c),s.reverse(),s},[t]),n=x({select:s=>s.matches.map(a=>a.links).filter(Boolean).flat(1).map(a=>({tag:"link",attrs:{...a}}))}),o=x({select:s=>{const a=[];return s.matches.map(c=>e.looseRoutesById[c.routeId]).forEach(c=>{var u,l,d;return(d=(l=(u=e.manifest)==null?void 0:u.routes[c.id])==null?void 0:l.preloads)==null?void 0:d.filter(Boolean).forEach(p=>{a.push({tag:"link",attrs:{rel:"modulepreload",href:p}})})}),a}});return tt([...r,...o,...n],s=>JSON.stringify(s))},Qe=()=>{const e=f(),t=Ve(),r=g.useContext(L.get("TanStackRouterHydrationContext",{}));return m(y,{children:[i("meta",{name:"tsr-meta"}),t.map((n,o)=>I(B,{...n,key:`tsr-meta-${JSON.stringify(n)}`})),m(y,{children:[i(S,{log:!1,children:`
__TSR__ = {
  matches: [],
  streamedValues: {},
  initMatch: (index) => {
    Object.entries(__TSR__.matches[index].extracted).forEach(([id, ex]) => {
      if (ex.type === 'stream') {
        let controller;
        ex.value = new ReadableStream({
          start(c) { controller = c; }
        })
        ex.value.controller = controller
      } else if (ex.type === 'promise') {
        let r, j
        ex.value = new Promise((r_, j_) => { r = r_, j = j_ })
        ex.resolve = r; ex.reject = j
      }
    })
  },
  cleanScripts: () => {
    document.querySelectorAll('.tsr-once').forEach((el) => {
      el.remove()
    })
  },
}`}),i(S,{children:`__TSR__.dehydrated = ${_(e.options.transformer.stringify(r),{isScriptContext:!0,wrap:!0,json:!0})}`})]}),i("meta",{name:"/tsr-meta"})]})},Xe=({children:e})=>{const t=f(),r=Qe(),[n,o]=g.useState(!1);g[typeof document<"u"?"useLayoutEffect":"useEffect"](()=>{if(typeof document>"u")return;const a=document.head.querySelector('meta[name="tsr-meta"]'),c=document.head.querySelector('meta[name="/tsr-meta"]');let u=a?.nextElementSibling;for(;u&&u!==c;){const l=u.nextElementSibling;u.remove(),u=l}a?.remove(),c?.remove(),o(!0)},[]);const s=m(y,{children:[r,e]});return t.isServer?s:n?ge(s,document.head):null};function Ye({children:e,...t}){return f().isServer?i("html",{children:e}):i(y,{children:e})}function Ke({children:e,...t}){return f().isServer?i("head",{children:e}):e}function et({children:e,...t}){return f().isServer?i("body",{children:i("div",{id:"root",children:e})}):e}function tt(e,t){const r=new Set;return e.filter(n=>{const o=t(n);return r.has(o)?!1:(r.add(o),!0)})}const rt=()=>{const e=f(),t=x({select:o=>{const s=[];return o.matches.map(a=>e.looseRoutesById[a.routeId]).forEach(a=>{var c,u,l;return(l=(u=(c=e.manifest)==null?void 0:c.routes[a.id])==null?void 0:u.assets)==null?void 0:l.filter(d=>d.tag==="script").forEach(d=>{s.push({tag:"script",attrs:d.attrs,children:d.children})})}),s}}),{scripts:r}=x({select:o=>({scripts:o.matches.map(s=>s.scripts).filter(Boolean).flat(1).map(({children:s,...a})=>({tag:"script",attrs:{...a,suppressHydrationWarning:!0},children:s}))})}),n=[...r,...t];return i(y,{children:n.map((o,s)=>I(B,{...o,key:`tsr-scripts-${o.tag}-${s}`}))})};function D({children:e}){return m("div",{className:"space-y-2 p-2",children:[i("div",{className:"text-gray-600 dark:text-gray-400",children:e||i("p",{children:"The page you are looking for does not exist."})}),m("p",{className:"flex flex-wrap items-center gap-2",children:[i("button",{onClick:()=>window.history.back(),className:"rounded bg-emerald-500 px-2 py-1 text-sm font-black uppercase text-white",children:"Go back"}),i(b,{to:"/",className:"rounded bg-cyan-600 px-2 py-1 text-sm font-black uppercase text-white",children:"Start Over"})]})]})}const nt=({title:e,description:t,keywords:r,image:n})=>[{title:e},{name:"description",content:t},{name:"keywords",content:r},{name:"twitter:title",content:e},{name:"twitter:description",content:t},{name:"twitter:creator",content:"@tannerlinsley"},{name:"twitter:site",content:"@tannerlinsley"},{name:"og:type",content:"website"},{name:"og:title",content:e},{name:"og:description",content:t},...n?[{name:"twitter:image",content:n},{name:"twitter:card",content:"summary_large_image"},{name:"og:image",content:n}]:[]],ot="/_build/assets/globals-DZyZsH2T.css",st={theme:"system",setTheme:()=>null},j=le(st);function Ct({children:e,defaultTheme:t="system",storageKey:r="ui-theme",...n}){const[o,s]=de(()=>localStorage.getItem(r)||t);me(()=>{const c=window.document.documentElement;if(c.classList.remove("light","dark"),o==="system"){const u=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";c.classList.add(u);return}c.classList.add(o)},[o]);const a={theme:o,setTheme:c=>{localStorage.setItem(r,c),s(c)}};return i(j.Provider,{...n,value:a,children:e})}const Et=()=>{const e=fe(j);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e},F=te({meta:()=>[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"Sviatoslav Chyzh - Software Engineer"},...nt({title:"TanStack Start | Type-Safe, Client-First, Full-Stack React Framework",description:"TanStack Start is a type-safe, client-first, full-stack React framework. "})],links:()=>[{rel:"stylesheet",href:ot}],notFoundComponent:()=>i(D,{}),component:at});function at(){return i(it,{children:i(re,{})})}function it({children:e}){return m(Ye,{children:[i(Ke,{children:i(Xe,{})}),m(et,{children:[e,i(ne,{}),i(rt,{})]})]})}const ct=()=>import("./index-BabbpXxs.js"),O=oe("/")({component:se(ct,"component",()=>O.ssr)}),ut=O.update({id:"/",path:"/",getParentRoute:()=>F}),lt={IndexRoute:ut},dt=F._addFileChildren(lt)._addFileTypes();function mt({error:e}){const t=f(),r=ae({strict:!1,select:n=>n.id===ie});return console.error(e),m("div",{className:"min-w-0 flex-1 p-4 flex flex-col items-center justify-center gap-6",children:[i(ce,{error:e}),m("div",{className:"flex gap-2 items-center flex-wrap",children:[i("button",{onClick:()=>{t.invalidate()},className:"px-2 py-1 bg-gray-600 dark:bg-gray-700 rounded text-white uppercase font-extrabold",children:"Try Again"}),r?i(b,{to:"/",className:"px-2 py-1 bg-gray-600 dark:bg-gray-700 rounded text-white uppercase font-extrabold",children:"Home"}):i(b,{to:"/",className:"px-2 py-1 bg-gray-600 dark:bg-gray-700 rounded text-white uppercase font-extrabold",onClick:n=>{n.preventDefault(),window.history.back()},children:"Go Back"})]})]})}function ft(){return ue({routeTree:dt,defaultErrorComponent:mt,defaultNotFoundComponent:()=>i(D,{})})}const Ht=Ae({createRouter:ft,getRouterManifest:Je})(Ue);export{Ct as T,Ht as h,Et as u};
