import{H3Event as R,getRequestURL as O,getResponseHeaders as z,getRequestWebStream as U,eventHandler as G}from"h3";import{getContext as V}from"unctx";import{AsyncLocalStorage as Z}from"node:async_hooks";import{isPlainArray as J,isPlainObject as P,defer as X,useRouter as f,ScriptOnce as x,pick as K,createControlledPromise as Q,RouterProvider as Y,createMemoryHistory as ee,useRouterState as S,Link as b,createRootRoute as te,Outlet as re,ScrollRestoration as ne,createFileRoute as oe,lazyRouteComponent as se,useMatch as ae,rootRouteId as ce,ErrorComponent as ie,createRouter as ue}from"@tanstack/react-router";import{jsxs as m,Fragment as y,jsx as c}from"react/jsx-runtime";import*as g from"react";import{createElement as I,createContext as le,useState as de,useEffect as me,useContext as fe}from"react";import v from"jsesc";import he from"tiny-invariant";import{Transform as pe,PassThrough as ye}from"node:stream";import{isbot as E}from"isbot";import _ from"react-dom/server";import{Context as L}from"@tanstack/react-cross-context";import{createPortal as ge}from"react-dom";function Se(e,t,r){if(!r.router.isServer)return t;r.match.extracted=r.match.extracted||[];const n=r.match.extracted;return T(t,(s,a)=>{const i=s instanceof ReadableStream?"stream":s instanceof Promise?"promise":void 0;if(i){const u={dataType:e,type:i,path:a,id:n.length,value:s,matchIndex:r.match.index};if(n.push(u),i==="stream"){const[l,d]=s.tee();return u.streamState=Re({stream:d}),l}else X(s)}return s})}function xe(e){const t=f(),r=t.state.matches[e.matchIndex];if(!t.isServer)return null;const n=r.extracted,[o,s]=["__beforeLoadContext","loaderData"].map(a=>n?n.reduce((i,u)=>u.dataType!==a?C(i,["temp",...u.path],void 0):i,{temp:r[a]}).temp:r[a]);return m(y,{children:[o!==void 0||s!==void 0||n?.length?c(x,{children:`__TSR__.matches[${e.matchIndex}] = ${v({__beforeLoadContext:t.options.transformer.stringify(o),loaderData:t.options.transformer.stringify(s),extracted:n?Object.fromEntries(n.map(a=>[a.id,K(a,["type","path"])])):{}},{isScriptContext:!0,wrap:!0,json:!0})}; __TSR__.initMatch(${e.matchIndex})`}):null,n?n.map((a,i)=>a.type==="stream"?c(we,{entry:a},a.id):c(ve,{entry:a},a.id)):null]})}function T(e,t,r=[]){if(J(e))return e.map((o,s)=>T(o,t,[...r,`${s}`]));if(P(e)){const o={};for(const s in e)o[s]=T(e[s],t,[...r,s]);return o}const n=t(e,r);return n!==e?n:e}function ve({entry:e}){return c("div",{className:"tsr-once",children:c(g.Suspense,{fallback:null,children:c(_e,{entry:e})})})}function _e({entry:e}){if(e.value.status==="pending")throw e.value;return c(x,{children:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].resolve(${v(e.value.data,{isScriptContext:!0,wrap:!0,json:!0})})`})}function we({entry:e}){return he(e.streamState,"StreamState should be defined"),c($,{streamState:e.streamState,children:t=>c(x,{children:t?`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.enqueue(new TextEncoder().encode(${v(t.toString(),{isScriptContext:!0,wrap:!0,json:!0})}))`:`__TSR__.matches[${e.matchIndex}].extracted[${e.id}].value.controller.close()`})})}function Re({stream:e}){const t={promises:[]},r=e.getReader(),n=o=>(t.promises[o]=Q(),r.read().then(({done:s,value:a})=>{if(s){t.promises[o].resolve(null),r.releaseLock();return}return t.promises[o].resolve(a),n(o+1)}));return n(0).catch(o=>{console.error("stream read error",o)}),t}function $({streamState:e,children:t,__index:r=0}){const n=e.promises[r];if(!n)return null;if(n.status==="pending")throw n;const o=n.value;return m(y,{children:[t(o),c("div",{className:"tsr-once",children:c(g.Suspense,{fallback:null,children:c($,{streamState:e,__index:r+1,children:t})})})]})}function C(e,t,r){if(t.length===0)return r;const[n,...o]=t;return Array.isArray(e)?e.map((s,a)=>a===Number(n)?C(s,o,r):s):P(e)?{...e,[n]:C(e[n],o,r)}:e}function H(e){e.router.AfterEachMatch=xe,e.router.serializer=n=>v(n,{isScriptContext:!0,wrap:!0,json:!0});const t=L.get("TanStackRouterHydrationContext",{}),r=g.useMemo(()=>{var n,o;return{router:e.router.dehydrate(),payload:(o=(n=e.router.options).dehydrate)==null?void 0:o.call(n)}},[e.router]);return c(t.Provider,{value:r,children:c(Y,{router:e.router})})}function be(e){let t;const r=A(e),n={duplex:"half",method:e.method,headers:e.headers};return e.node.req.body instanceof ArrayBuffer?new Request(r,{...n,body:e.node.req.body}):new Request(r,{...n,get body(){return t||(t=He(e),t)}})}function Te(e){return e.web??={request:be(e),url:A(e)},e.web.request}function Ce(){return Pe()}const q=Symbol("$HTTPEvent");function ke(e){return typeof e=="object"&&(e instanceof R||e?.[q]instanceof R||e?.__is_event__===!0)}function k(e){return function(...t){let r=t[0];if(ke(r))t[0]=r instanceof R||r.__is_event__?r:r[q];else{if(!globalThis.app.config.server.experimental?.asyncContext)throw new Error("AsyncLocalStorage was not enabled. Use the `server.experimental.asyncContext: true` option in your app configuration to enable it. Or, pass the instance of HTTPEvent that you have as the first argument to the function.");if(r=Ce(),!r)throw new Error("No HTTPEvent found in AsyncLocalStorage. Make sure you are using the function within the server runtime.");t.unshift(r)}return e(...t)}}const A=k(O),Ee=k(z),He=k(U);function Me(){return V("nitro-app",{asyncContext:!!globalThis.app.config.server.experimental?.asyncContext,AsyncLocalStorage:Z})}function Pe(){return Me().use().event}function Ie(e){return e instanceof Headers?new Headers(e):Array.isArray(e)?new Headers(e):typeof e=="object"?new Headers(e):new Headers}function M(...e){return e.reduce((t,r)=>{const n=Ie(r);for(const[o,s]of n.entries())t.set(o,s);return t},new Headers)}const Le="server-fn-return-type",$e="server-fn-payload-type";function qe({createRouter:e,getRouterManifest:t}){return r=>G(async n=>{const o=Te(n),s=new URL(o.url),a=s.href.replace(s.origin,""),i=ee({initialEntries:[a]}),u=e();u.serializeLoaderData=Se,t&&(u.manifest=t()),u.update({history:i}),await u.load();const l=Ae({event:n,router:u});return await r({request:o,router:u,responseHeaders:l})})}function Ae(e){e.event.__tsrHeadersSent=!0;let t=M(Ee(e.event),{"Content-Type":"text/html; charset=UTF-8"},...e.router.state.matches.map(n=>n.headers));const{redirect:r}=e.router.state;return r&&(t=M(t,r.headers,{Location:r.href})),[Le,$e].forEach(n=>{t.delete(n)}),t}function Ne(e){const t=N(()=>e.injectedHtml.map(r=>r()).join(""));return new pe({transform(r,n,o){t.transform(r,this.push.bind(this)).then(()=>o()).catch(s=>o(s))},flush(r){t.flush(this.push.bind(this)).then(()=>r()).catch(n=>r(n))}})}function De(e){const t=N(()=>e.injectedHtml.map(n=>n()).join("")),r=new TextEncoder;return new TransformStream({transform(n,o){return t.transform(n,s=>(o.enqueue(r.encode(s)),!0))},flush(n){return t.flush(o=>(n.enqueue(o),!0))}})}const Be=/(<body)/,Fe=/(<\/body>)/,je=/(<\/html>)/,We=/(<\/[a-zA-Z][\w:.-]*?>)/g,Oe=new TextDecoder;function N(e){let t=!1,r="",n="";return{async transform(o,s){const a=r+Oe.decode(o),i=a.match(Be),u=a.match(Fe),l=a.match(je);try{if(i&&(t=!0),!t){s(a),r="";return}const d=e();if(u&&l&&u.index<l.index){const h=u.index+u[0].length,p=l.index+l[0].length,w=a.slice(0,h)+d+a.slice(h,p)+a.slice(p);s(w),r=""}else{let h,p=0;for(;(h=We.exec(a))!==null;)p=h.index+h[0].length;if(p>0){const w=a.slice(0,p)+d+n;s(w),r=a.slice(p)}else r=a,n+=d}}catch(d){throw console.error(d),d}},async flush(o){r&&o(r)}}}const ze=async({request:e,router:t,responseHeaders:r})=>{if(typeof _.renderToReadableStream=="function"){const n=await _.renderToReadableStream(c(H,{router:t}),{signal:e.signal,onError(a,i){console.error(a,i)}});E(e.headers.get("User-Agent"))&&await n.allReady;const s=[De(t)].reduce((a,i)=>a.pipeThrough(i),n);return new Response(s,{status:t.state.statusCode,headers:r})}if(typeof _.renderToPipeableStream=="function"){const n=new ye,o=_.renderToPipeableStream(c(H,{router:t}),{...E(e.headers.get("User-Agent"))?{onAllReady(){o.pipe(n)}}:{onShellReady(){o.pipe(n)}},onShellError(i){throw i}}),a=[Ne(t)].reduce((i,u)=>i.pipe(u),n);return new Response(a,{status:t.state.statusCode,headers:r})}throw new Error("No renderToReadableStream or renderToPipeableStream found in react-dom/server. Ensure you are using a version of react-dom that supports streaming.")},Ue=()=>({routes:{__root__:{filePath:"__root.tsx",children:["/"],preloads:["/_build/assets/client-CGHMqvHS.js","/_build/assets/client-CXVXPGKT.js"]},"/":{filePath:"index.tsx"}}});function Ge(e){return globalThis.MANIFEST[e]}function Ve(){const e=Ue(),t=e.routes.__root__=e.routes.__root__||{};t.assets=t.assets||[];const r=Ge("client");return t.assets.push({tag:"script",attrs:{src:r.inputs[r.handler]?.output.path,type:"module",async:!0,suppressHydrationWarning:!0}}),e}function Ze(){const e=Ve();return{...e,routes:Object.fromEntries(Object.entries(e.routes).map(([t,r])=>{const{preloads:n,assets:o}=r;return[t,{preloads:n,assets:o}]}))}}function D({tag:e,attrs:t,children:r}){switch(e){case"title":return c("title",{...t,suppressHydrationWarning:!0,children:r});case"meta":return c("meta",{...t,suppressHydrationWarning:!0});case"link":return c("link",{...t,suppressHydrationWarning:!0});case"style":return c("style",{...t,dangerouslySetInnerHTML:{__html:r}});case"script":return t&&t.src?c("script",{...t,suppressHydrationWarning:!0}):typeof r=="string"?c("script",{...t,dangerouslySetInnerHTML:{__html:r},suppressHydrationWarning:!0}):null;default:return null}}const Je=()=>{const e=f(),t=S({select:s=>s.matches.map(a=>a.meta).filter(Boolean)}),r=g.useMemo(()=>{const s=[],a={};let i;return[...t].reverse().forEach(u=>{[...u].reverse().forEach(l=>{if(l.title)i||(i={tag:"title",children:l.title});else{if(l.name){if(a[l.name])return;a[l.name]=!0}s.push({tag:"meta",attrs:{...l}})}})}),i&&s.push(i),s.reverse(),s},[t]),n=S({select:s=>s.matches.map(a=>a.links).filter(Boolean).flat(1).map(a=>({tag:"link",attrs:{...a}}))}),o=S({select:s=>{const a=[];return s.matches.map(i=>e.looseRoutesById[i.routeId]).forEach(i=>{var u,l,d;return(d=(l=(u=e.manifest)==null?void 0:u.routes[i.id])==null?void 0:l.preloads)==null?void 0:d.filter(Boolean).forEach(h=>{a.push({tag:"link",attrs:{rel:"modulepreload",href:h}})})}),a}});return tt([...r,...o,...n],s=>JSON.stringify(s))},Xe=()=>{const e=f(),t=Je(),r=g.useContext(L.get("TanStackRouterHydrationContext",{}));return m(y,{children:[c("meta",{name:"tsr-meta"}),t.map((n,o)=>I(D,{...n,key:`tsr-meta-${JSON.stringify(n)}`})),m(y,{children:[c(x,{log:!1,children:`
__TSR__ = {
  matches: [],
  streamedValues: {},
  initMatch: (index) => {
    Object.entries(__TSR__.matches[index].extracted).forEach(([id, ex]) => {
      if (ex.type === 'stream') {
        let controller;
        ex.value = new ReadableStream({
          start(c) { controller = c; }
        })
        ex.value.controller = controller
      } else if (ex.type === 'promise') {
        let r, j
        ex.value = new Promise((r_, j_) => { r = r_, j = j_ })
        ex.resolve = r; ex.reject = j
      }
    })
  },
  cleanScripts: () => {
    document.querySelectorAll('.tsr-once').forEach((el) => {
      el.remove()
    })
  },
}`}),c(x,{children:`__TSR__.dehydrated = ${v(e.options.transformer.stringify(r),{isScriptContext:!0,wrap:!0,json:!0})}`})]}),c("meta",{name:"/tsr-meta"})]})},Ke=({children:e})=>{const t=f(),r=Xe(),[n,o]=g.useState(!1);g[typeof document<"u"?"useLayoutEffect":"useEffect"](()=>{if(typeof document>"u")return;const a=document.head.querySelector('meta[name="tsr-meta"]'),i=document.head.querySelector('meta[name="/tsr-meta"]');let u=a?.nextElementSibling;for(;u&&u!==i;){const l=u.nextElementSibling;u.remove(),u=l}a?.remove(),i?.remove(),o(!0)},[]);const s=m(y,{children:[r,e]});return t.isServer?s:n?ge(s,document.head):null};function Qe({children:e,...t}){return f().isServer?c("html",{children:e}):c(y,{children:e})}function Ye({children:e,...t}){return f().isServer?c("head",{children:e}):e}function et({children:e,...t}){return f().isServer?c("body",{children:c("div",{id:"root",children:e})}):e}function tt(e,t){const r=new Set;return e.filter(n=>{const o=t(n);return r.has(o)?!1:(r.add(o),!0)})}const rt=()=>{const e=f(),t=S({select:o=>{const s=[];return o.matches.map(a=>e.looseRoutesById[a.routeId]).forEach(a=>{var i,u,l;return(l=(u=(i=e.manifest)==null?void 0:i.routes[a.id])==null?void 0:u.assets)==null?void 0:l.filter(d=>d.tag==="script").forEach(d=>{s.push({tag:"script",attrs:d.attrs,children:d.children})})}),s}}),{scripts:r}=S({select:o=>({scripts:o.matches.map(s=>s.scripts).filter(Boolean).flat(1).map(({children:s,...a})=>({tag:"script",attrs:{...a,suppressHydrationWarning:!0},children:s}))})}),n=[...r,...t];return c(y,{children:n.map((o,s)=>I(D,{...o,key:`tsr-scripts-${o.tag}-${s}`}))})};function B({children:e}){return m("div",{className:"space-y-2 p-2",children:[c("div",{className:"text-gray-600 dark:text-gray-400",children:e||c("p",{children:"The page you are looking for does not exist."})}),m("p",{className:"flex flex-wrap items-center gap-2",children:[c("button",{onClick:()=>window.history.back(),className:"rounded bg-emerald-500 px-2 py-1 text-sm font-black uppercase text-white",children:"Go back"}),c(b,{to:"/",className:"rounded bg-cyan-600 px-2 py-1 text-sm font-black uppercase text-white",children:"Start Over"})]})]})}const nt=({title:e,description:t,keywords:r,image:n})=>[{title:e},{name:"description",content:t},{name:"keywords",content:r},{name:"twitter:title",content:e},{name:"twitter:description",content:t},{name:"twitter:creator",content:"@tannerlinsley"},{name:"twitter:site",content:"@tannerlinsley"},{name:"og:type",content:"website"},{name:"og:title",content:e},{name:"og:description",content:t},...n?[{name:"twitter:image",content:n},{name:"twitter:card",content:"summary_large_image"},{name:"og:image",content:n}]:[]],ot="/_build/assets/globals-DZyZsH2T.css",st={theme:"system",setTheme:()=>null},F=le(st);function kt({children:e,defaultTheme:t="system",storageKey:r="ui-theme",...n}){const[o,s]=de(()=>localStorage.getItem(r)||t);me(()=>{const i=window.document.documentElement;if(i.classList.remove("light","dark"),o==="system"){const u=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light";i.classList.add(u);return}i.classList.add(o)},[o]);const a={theme:o,setTheme:i=>{localStorage.setItem(r,i),s(i)}};return c(F.Provider,{...n,value:a,children:e})}const Et=()=>{const e=fe(F);if(e===void 0)throw new Error("useTheme must be used within a ThemeProvider");return e},j=te({meta:()=>[{charSet:"utf-8"},{name:"viewport",content:"width=device-width, initial-scale=1"},{title:"Sviatoslav Chyzh - Software Engineer"},...nt({title:"TanStack Start | Type-Safe, Client-First, Full-Stack React Framework",description:"TanStack Start is a type-safe, client-first, full-stack React framework. "})],links:()=>[{rel:"stylesheet",href:ot}],notFoundComponent:()=>c(B,{}),component:at});function at(){return c(ct,{children:c(re,{})})}function ct({children:e}){return m(Qe,{children:[c(Ye,{children:c(Ke,{})}),m(et,{children:[e,c(ne,{}),c(rt,{})]})]})}const it=()=>import("./index-C0o0UQRK.js"),W=oe("/")({component:se(it,"component",()=>W.ssr)}),ut=W.update({id:"/",path:"/",getParentRoute:()=>j}),lt={IndexRoute:ut},dt=j._addFileChildren(lt)._addFileTypes();function mt({error:e}){const t=f(),r=ae({strict:!1,select:n=>n.id===ce});return console.error(e),m("div",{className:"min-w-0 flex-1 p-4 flex flex-col items-center justify-center gap-6",children:[c(ie,{error:e}),m("div",{className:"flex gap-2 items-center flex-wrap",children:[c("button",{onClick:()=>{t.invalidate()},className:"px-2 py-1 bg-gray-600 dark:bg-gray-700 rounded text-white uppercase font-extrabold",children:"Try Again"}),r?c(b,{to:"/",className:"px-2 py-1 bg-gray-600 dark:bg-gray-700 rounded text-white uppercase font-extrabold",children:"Home"}):c(b,{to:"/",className:"px-2 py-1 bg-gray-600 dark:bg-gray-700 rounded text-white uppercase font-extrabold",onClick:n=>{n.preventDefault(),window.history.back()},children:"Go Back"})]})]})}function ft(){return ue({routeTree:dt,defaultErrorComponent:mt,defaultNotFoundComponent:()=>c(B,{})})}const Ht=qe({createRouter:ft,getRouterManifest:Ze})(ze);export{kt as T,Ht as h,Et as u};
